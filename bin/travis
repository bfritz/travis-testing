#!/bin/bash -x

set -e

WATCHDOG_PID=""
function find_sbt_pid() {
    pgrep -f sbt-launch
}

function start_watchdog() {
    echo "Watchdog will wake up in $1"
    (sleep "$1" && echo "Watchdog launched jstack." && echo k $(find_sbt_pid)) &
    WATCHDOG_PID=$(pgrep --newest sleep)
    echo "PID: $WATCHDOG_PID"
}

function stop_watchdog() {
    ([ -n "$WATCHDOG_PID" ] && kill "$WATCHDOG_PID") || true
}


start_watchdog 30s
sleep 45s
stop_watchdog

